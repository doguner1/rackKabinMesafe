<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Veri Merkezi - Kullanıcı Yönetimi</title>
  <link rel="stylesheet" href="styles/beyazalan.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    .admin-container {
      max-width: 800px;
      margin: 50px auto;
      padding: 30px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    
    .admin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .admin-title {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .admin-actions {
      display: flex;
      gap: 10px;
    }
    
    .user-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-bottom: 30px;
      padding: 20px;
      background-color: var(--light-color);
      border-radius: 8px;
    }
    
    .form-row {
      display: flex;
      gap: 20px;
    }
    
    .form-group {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .form-group label {
      font-weight: 600;
      color: var(--dark-color);
    }
    
    .form-group input {
      padding: 10px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: 14px;
    }
    
    .user-list {
      width: 100%;
      border-collapse: collapse;
    }
    
    .user-list th, .user-list td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }
    
    .user-list th {
      background-color: var(--primary-color);
      color: white;
      font-weight: 600;
    }
    
    .user-list tr:nth-child(even) {
      background-color: var(--light-color);
    }
    
    .user-actions {
      display: flex;
      gap: 10px;
    }
    
    .btn-small {
      padding: 6px 10px;
      font-size: 12px;
    }
    
    .btn-danger {
      background-color: var(--accent-color);
    }
    
    .btn-danger:hover {
      background-color: #c0392b;
    }
    
    .message {
      padding: 10px;
      border-radius: 4px;
      margin-bottom: 20px;
      display: none;
    }
    
    .message-success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .message-error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="admin-container">
      <div class="admin-header">
        <div class="admin-title">
          <h1><i class="fas fa-users-cog"></i> Kullanıcı Yönetimi</h1>
        </div>
        <div class="admin-actions">
          <button id="logout-button" class="btn"><i class="fas fa-sign-out-alt"></i> Çıkış Yap</button>
        </div>
      </div>
      
      <div id="message" class="message"></div>
      
      <div class="user-form">
        <h2>Kullanıcı Ekle</h2>
        <div class="form-row">
          <div class="form-group">
            <label for="username">Kullanıcı Adı</label>
            <input type="text" id="username" placeholder="Kullanıcı adı girin">
          </div>
          <div class="form-group">
            <label for="password">Şifre</label>
            <input type="password" id="password" placeholder="Şifre girin">
          </div>
        </div>
        <button id="add-user-button" class="btn"><i class="fas fa-user-plus"></i> Kullanıcı Ekle</button>
      </div>
      
      <h2>Kullanıcı Listesi</h2>
      <table class="user-list">
        <thead>
          <tr>
            <th>Kullanıcı Adı</th>
            <th>Yetki</th>
            <th>İşlemler</th>
          </tr>
        </thead>
        <tbody id="user-list-body">
          <!-- Kullanıcılar JavaScript ile buraya eklenecek -->
        </tbody>
      </table>
    </div>
  </div>
  
  <script src="js/components/UserManager.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Kullanıcı yöneticisini başlat
      const userManager = new UserManager();
      
      // Mevcut kullanıcıyı kontrol et
      const currentUser = userManager.getCurrentUser();
      if (!currentUser || !currentUser.isAdmin) {
        // Admin değilse giriş sayfasına yönlendir
        window.location.href = 'login.html';
        return;
      }
      
      // Kullanıcı listesini yükle
      loadUserList();
      
      // Kullanıcı ekleme
      const addUserButton = document.getElementById('add-user-button');
      const usernameInput = document.getElementById('username');
      const passwordInput = document.getElementById('password');
      
      addUserButton.addEventListener('click', () => {
        const username = usernameInput.value.trim();
        const password = passwordInput.value.trim();
        
        if (username && password) {
          const result = userManager.addUser(username, password);
          
          if (result) {
            showMessage('Kullanıcı başarıyla eklendi.', 'success');
            usernameInput.value = '';
            passwordInput.value = '';
            loadUserList();
          } else {
            showMessage('Bu kullanıcı adı zaten kullanılıyor.', 'error');
          }
        } else {
          showMessage('Lütfen tüm alanları doldurun.', 'error');
        }
      });
      
      // Çıkış yapma
      const logoutButton = document.getElementById('logout-button');
      logoutButton.addEventListener('click', () => {
        userManager.logout();
        window.location.href = 'login.html';
      });
      
      // Kullanıcı listesini yükle
      function loadUserList() {
        const users = userManager.getUsers();
        const userListBody = document.getElementById('user-list-body');
        userListBody.innerHTML = '';
        
        users.forEach(user => {
          const row = document.createElement('tr');
          
          const usernameCell = document.createElement('td');
          usernameCell.textContent = user.username;
          
          const roleCell = document.createElement('td');
          roleCell.textContent = user.isAdmin ? 'Admin' : 'Kullanıcı';
          
          const actionsCell = document.createElement('td');
          actionsCell.className = 'user-actions';
          
          // Şifre değiştirme butonu
          const changePasswordButton = document.createElement('button');
          changePasswordButton.className = 'btn btn-small';
          changePasswordButton.innerHTML = '<i class="fas fa-key"></i> Şifre Değiştir';
          changePasswordButton.addEventListener('click', () => {
            const newPassword = prompt(`${user.username} için yeni şifre girin:`);
            if (newPassword) {
              userManager.updatePassword(user.username, newPassword);
              showMessage('Şifre başarıyla değiştirildi.', 'success');
            }
          });
          
          // Görev Ata butonu
          const assignTaskButton = document.createElement('button');
          assignTaskButton.className = 'btn btn-small';
          assignTaskButton.style.backgroundColor = '#1a237e'; // Koyu mavi renk
          assignTaskButton.style.color = 'white'; // Yazı rengi beyaz olsun
          assignTaskButton.innerHTML = '<i class="fas fa-tasks"></i> Görev Ata';
          assignTaskButton.addEventListener('click', () => {
            // Görev atama modalını oluştur
            createTaskAssignModal(user.username);
          });
          
          // Silme butonu (admin için gösterme)
          if (!user.isAdmin) {
            const deleteButton = document.createElement('button');
            deleteButton.className = 'btn btn-small btn-danger';
            deleteButton.innerHTML = '<i class="fas fa-trash"></i> Sil';
            deleteButton.addEventListener('click', () => {
              if (confirm(`${user.username} kullanıcısını silmek istediğinize emin misiniz?`)) {
                userManager.deleteUser(user.username);
                loadUserList();
                showMessage('Kullanıcı başarıyla silindi.', 'success');
              }
            });
            
            // Rapor Geçmişi butonu
            const reportHistoryButton = document.createElement('button');
            reportHistoryButton.className = 'btn btn-small';
            reportHistoryButton.style.backgroundColor = '#6a1b9a'; // Mor renk
            reportHistoryButton.style.color = 'white'; // Yazı rengi beyaz
            reportHistoryButton.innerHTML = '<i class="fas fa-history"></i> Rapor Geçmişi';
            reportHistoryButton.addEventListener('click', () => {
              // Rapor geçmişi modalını oluştur
              createReportHistoryModal(user.username);
            });
            
            actionsCell.appendChild(deleteButton);
            actionsCell.appendChild(assignTaskButton); // Görev Ata butonunu sadece normal kullanıcılar için ekle
            actionsCell.appendChild(reportHistoryButton); // Rapor Geçmişi butonunu ekle
          }
          
          actionsCell.appendChild(changePasswordButton);
          // Görev Ata butonunu buradan kaldırıyoruz
          
          row.appendChild(usernameCell);
          row.appendChild(roleCell);
          row.appendChild(actionsCell);
          
          userListBody.appendChild(row);
        });
      }
      
      // Mesaj gösterme
      function showMessage(text, type) {
        const messageElement = document.getElementById('message');
        messageElement.textContent = text;
        messageElement.className = `message message-${type}`;
        messageElement.style.display = 'block';
        
        setTimeout(() => {
          messageElement.style.display = 'none';
        }, 3000);
      }
      
      // Görev atama modalını oluştur
      function createTaskAssignModal(username) {
        // Eğer zaten bir modal varsa kaldır
        const existingModal = document.getElementById('task-assign-modal');
        if (existingModal) {
          document.body.removeChild(existingModal);
        }
        
        // Modal oluştur
        const modal = document.createElement('div');
        modal.id = 'task-assign-modal';
        modal.className = 'modal';
        modal.style.display = 'block';
        
        // Modal içeriği
        const modalContent = document.createElement('div');
        modalContent.className = 'modal-content';
        modalContent.style.maxWidth = '500px';
        modalContent.style.padding = '20px';
        modalContent.style.borderRadius = '8px';
        
        // Başlık
        const title = document.createElement('h2');
        title.innerHTML = `<i class="fas fa-tasks"></i> ${username} için Görev Ata`;
        title.style.marginBottom = '20px';
        title.style.color = '#1a237e';
        
        // Kapat butonu
        const closeButton = document.createElement('span');
        closeButton.className = 'close-button';
        closeButton.innerHTML = '&times;';
        closeButton.style.position = 'absolute';
        closeButton.style.top = '10px';
        closeButton.style.right = '15px';
        closeButton.style.fontSize = '24px';
        closeButton.style.cursor = 'pointer';
        closeButton.addEventListener('click', () => {
          modal.style.display = 'none';
          document.body.removeChild(modal);
        });
        
        // Form oluştur
        const form = document.createElement('div');
        form.className = 'task-form';
        
        // Görev başlığı
        const taskTitleGroup = document.createElement('div');
        taskTitleGroup.className = 'form-group';
        taskTitleGroup.style.marginBottom = '15px';
        
        const taskTitleLabel = document.createElement('label');
        taskTitleLabel.htmlFor = 'task-title';
        taskTitleLabel.textContent = 'Görev:';
        taskTitleLabel.style.display = 'block';
        taskTitleLabel.style.marginBottom = '5px';
        taskTitleLabel.style.fontWeight = '600';
        
        const taskTitleInput = document.createElement('input');
        taskTitleInput.type = 'text';
        taskTitleInput.id = 'task-title';
        taskTitleInput.placeholder = 'Görev açıklaması girin...';
        taskTitleInput.style.width = '100%';
        taskTitleInput.style.padding = '10px';
        taskTitleInput.style.borderRadius = '4px';
        taskTitleInput.style.border = '1px solid #ddd';
        taskTitleInput.style.fontSize = '14px';
        
        taskTitleGroup.appendChild(taskTitleLabel);
        taskTitleGroup.appendChild(taskTitleInput);
        
        // Öncelik seçimi
        const priorityGroup = document.createElement('div');
        priorityGroup.className = 'form-group';
        priorityGroup.style.marginBottom = '20px';
        
        const priorityLabel = document.createElement('label');
        priorityLabel.htmlFor = 'task-priority';
        priorityLabel.textContent = 'Öncelik:';
        priorityLabel.style.display = 'block';
        priorityLabel.style.marginBottom = '5px';
        priorityLabel.style.fontWeight = '600';
        
        const prioritySelect = document.createElement('select');
        prioritySelect.id = 'task-priority';
        prioritySelect.style.width = '100%';
        prioritySelect.style.padding = '10px';
        prioritySelect.style.borderRadius = '4px';
        prioritySelect.style.border = '1px solid #ddd';
        prioritySelect.style.fontSize = '14px';
        
        const priorities = [
          { value: 'normal', text: 'Normal', color: '#4CAF50' },
          { value: 'important', text: 'Önemli', color: '#FF9800' },
          { value: 'urgent', text: 'Acil', color: '#F44336' }
        ];
        
        priorities.forEach(priority => {
          const option = document.createElement('option');
          option.value = priority.value;
          option.textContent = priority.text;
          option.style.color = priority.color;
          prioritySelect.appendChild(option);
        });
        
        priorityGroup.appendChild(priorityLabel);
        priorityGroup.appendChild(prioritySelect);
        
        // Görev atama butonu
        const assignButton = document.createElement('button');
        assignButton.className = 'btn';
        assignButton.innerHTML = '<i class="fas fa-paper-plane"></i> Görevi Ata';
        assignButton.style.width = '100%';
        assignButton.style.padding = '12px';
        assignButton.style.backgroundColor = '#1a237e';
        assignButton.style.color = 'white';
        assignButton.style.border = 'none';
        assignButton.style.borderRadius = '4px';
        assignButton.style.cursor = 'pointer';
        assignButton.style.fontSize = '16px';
        assignButton.style.fontWeight = '600';
        assignButton.style.transition = 'background-color 0.3s';
        
        assignButton.addEventListener('mouseover', () => {
          assignButton.style.backgroundColor = '#303f9f';
        });
        
        assignButton.addEventListener('mouseout', () => {
          assignButton.style.backgroundColor = '#1a237e';
        });
        
        assignButton.addEventListener('click', () => {
          const taskTitle = taskTitleInput.value.trim();
          const taskPriority = prioritySelect.value;
          
          if (taskTitle) {
            // TodoManager sınıfını kullanarak görevi ata
            assignTaskToUser(username, taskTitle, taskPriority);
            
            // Başarılı mesajı göster
            showMessage(`"${taskTitle}" görevi ${username} kullanıcısına atandı.`, 'success');
            
            // Modalı kapat
            modal.style.display = 'none';
            document.body.removeChild(modal);
          } else {
            alert('Lütfen bir görev açıklaması girin.');
          }
        });
        
        // Form elemanlarını ekle
        form.appendChild(taskTitleGroup);
        form.appendChild(priorityGroup);
        form.appendChild(assignButton);
        
        // Modal içeriğini oluştur
        modalContent.appendChild(closeButton);
        modalContent.appendChild(title);
        modalContent.appendChild(form);
        
        // Modalı sayfaya ekle
        modal.appendChild(modalContent);
        document.body.appendChild(modal);
        
        // Input'a odaklan
        taskTitleInput.focus();
      }
      
      // Kullanıcıya görev atama fonksiyonu
      function assignTaskToUser(username, taskText, priority) {
        // Tüm görevleri doğrudan localStorage'dan yükle
        const allTodos = JSON.parse(localStorage.getItem('todos')) || [];
        
        // Yeni görevi oluştur
        const newTask = {
          id: Date.now().toString(),
          text: taskText,
          completed: false,
          username: username,
          createdAt: new Date().toISOString(),
          assignedBy: userManager.getCurrentUser().username,
          priority: priority
        };
        
        // Görevi listeye ekle
        allTodos.push(newTask);
        
        // Görevleri kaydet
        localStorage.setItem('todos', JSON.stringify(allTodos));
        
        // Konsola bilgi yazdır (hata ayıklama için)
        console.log(`Görev eklendi: ${JSON.stringify(newTask)}`);
        console.log(`Tüm görevler: ${JSON.stringify(allTodos)}`);
      }
      
      // Rapor geçmişi modalını oluştur
      function createReportHistoryModal(username) {
        // Eğer zaten bir modal varsa kaldır
        const existingModal = document.getElementById('report-history-modal');
        if (existingModal) {
          document.body.removeChild(existingModal);
        }
        
        // Modal oluştur
        const modal = document.createElement('div');
        modal.id = 'report-history-modal';
        modal.className = 'modal';
        modal.style.display = 'block';
        
        // Modal içeriği
        const modalContent = document.createElement('div');
        modalContent.className = 'modal-content';
        modalContent.style.maxWidth = '800px';
        modalContent.style.padding = '20px';
        modalContent.style.borderRadius = '8px';
        
        // Başlık
        const title = document.createElement('h2');
        title.innerHTML = `<i class="fas fa-history"></i> ${username} Kullanıcısının Rapor Geçmişi`;
        title.style.marginBottom = '20px';
        title.style.color = '#6a1b9a';
        
        // Kapat butonu
        const closeButton = document.createElement('span');
        closeButton.className = 'close-button';
        closeButton.innerHTML = '&times;';
        closeButton.style.position = 'absolute';
        closeButton.style.top = '10px';
        closeButton.style.right = '15px';
        closeButton.style.fontSize = '24px';
        closeButton.style.cursor = 'pointer';
        closeButton.addEventListener('click', () => {
          modal.style.display = 'none';
          document.body.removeChild(modal);
        });
        
        // Tüm görevleri yükle
        const allTodos = JSON.parse(localStorage.getItem('todos')) || [];
        
        // Kullanıcının görevlerini filtrele
        const userTodos = allTodos.filter(todo => todo.username === username);
        
        // Tamamlanan ve tamamlanmayan görevleri ayır
        const completedTasks = userTodos.filter(todo => todo.completed);
        const pendingTasks = userTodos.filter(todo => !todo.completed);
        
        // Rapor içeriği
        const reportContent = document.createElement('div');
        reportContent.className = 'report-content';
        
        // Sekme başlıkları
        const tabsContainer = document.createElement('div');
        tabsContainer.className = 'tabs-container';
        tabsContainer.style.display = 'flex';
        tabsContainer.style.borderBottom = '1px solid #ddd';
        tabsContainer.style.marginBottom = '20px';
        
        const completedTab = document.createElement('div');
        completedTab.className = 'tab active';
        completedTab.textContent = `Tamamlanan Görevler (${completedTasks.length})`;
        completedTab.style.padding = '10px 20px';
        completedTab.style.cursor = 'pointer';
        completedTab.style.backgroundColor = '#f0f0f0';
        completedTab.style.borderRadius = '5px 5px 0 0';
        completedTab.style.borderBottom = '3px solid #6a1b9a';
        
        const pendingTab = document.createElement('div');
        pendingTab.className = 'tab';
        pendingTab.textContent = `Bekleyen Görevler (${pendingTasks.length})`;
        pendingTab.style.padding = '10px 20px';
        pendingTab.style.cursor = 'pointer';
        pendingTab.style.marginLeft = '10px';
        
        tabsContainer.appendChild(completedTab);
        tabsContainer.appendChild(pendingTab);
        
        // Görev içeriği konteynerı
        const tasksContainer = document.createElement('div');
        tasksContainer.className = 'tasks-container';
        
        // Tamamlanan görevler listesi
        const completedTasksList = document.createElement('div');
        completedTasksList.className = 'tasks-list completed-tasks';
        completedTasksList.style.display = 'block';
        
        // Bekleyen görevler listesi
        const pendingTasksList = document.createElement('div');
        pendingTasksList.className = 'tasks-list pending-tasks';
        pendingTasksList.style.display = 'none';
        
        // Görevleri listelere ekle
        if (completedTasks.length > 0) {
          completedTasks.forEach(task => {
            const taskItem = createTaskItem(task, true);
            completedTasksList.appendChild(taskItem);
          });
        } else {
          const emptyMessage = document.createElement('p');
          emptyMessage.textContent = 'Tamamlanan görev bulunmamaktadır.';
          emptyMessage.style.textAlign = 'center';
          emptyMessage.style.color = '#666';
          emptyMessage.style.padding = '20px';
          completedTasksList.appendChild(emptyMessage);
        }
        
        if (pendingTasks.length > 0) {
          pendingTasks.forEach(task => {
            const taskItem = createTaskItem(task, false);
            pendingTasksList.appendChild(taskItem);
          });
        } else {
          const emptyMessage = document.createElement('p');
          emptyMessage.textContent = 'Bekleyen görev bulunmamaktadır.';
          emptyMessage.style.textAlign = 'center';
          emptyMessage.style.color = '#666';
          emptyMessage.style.padding = '20px';
          pendingTasksList.appendChild(emptyMessage);
        }
        
        // Sekme değiştirme işlevselliği
        completedTab.addEventListener('click', () => {
          completedTab.style.backgroundColor = '#f0f0f0';
          completedTab.style.borderBottom = '3px solid #6a1b9a';
          pendingTab.style.backgroundColor = 'transparent';
          pendingTab.style.borderBottom = 'none';
          completedTasksList.style.display = 'block';
          pendingTasksList.style.display = 'none';
        });
        
        pendingTab.addEventListener('click', () => {
          pendingTab.style.backgroundColor = '#f0f0f0';
          pendingTab.style.borderBottom = '3px solid #6a1b9a';
          completedTab.style.backgroundColor = 'transparent';
          completedTab.style.borderBottom = 'none';
          pendingTasksList.style.display = 'block';
          completedTasksList.style.display = 'none';
        });
        
        // Görev listelerini konteyner'a ekle
        tasksContainer.appendChild(completedTasksList);
        tasksContainer.appendChild(pendingTasksList);
        
        // Rapor içeriğini oluştur
        reportContent.appendChild(tabsContainer);
        reportContent.appendChild(tasksContainer);
        
        // Modal içeriğini oluştur
        modalContent.appendChild(closeButton);
        modalContent.appendChild(title);
        modalContent.appendChild(reportContent);
        
        // Modalı sayfaya ekle
        modal.appendChild(modalContent);
        document.body.appendChild(modal);
      }
      
      // Görev öğesi oluşturma fonksiyonu
      function createTaskItem(task, isCompleted) {
        const taskItem = document.createElement('div');
        taskItem.className = 'task-item';
        taskItem.style.padding = '15px';
        taskItem.style.borderRadius = '5px';
        taskItem.style.marginBottom = '10px';
        taskItem.style.boxShadow = '0 2px 5px rgba(0,0,0,0.1)';
        taskItem.style.display = 'flex';
        taskItem.style.justifyContent = 'space-between';
        taskItem.style.alignItems = 'center';
        taskItem.style.backgroundColor = isCompleted ? '#f0f8ff' : '#fff5f5';
        
        // Görev içeriği
        const taskContent = document.createElement('div');
        taskContent.className = 'task-content';
        
        // Görev metni
        const taskText = document.createElement('div');
        taskText.className = 'task-text';
        taskText.textContent = task.text;
        taskText.style.fontSize = '16px';
        taskText.style.fontWeight = 'bold';
        taskText.style.marginBottom = '5px';
        
        // Öncelik etiketi
        if (task.priority) {
          const priorityBadge = document.createElement('span');
          priorityBadge.className = 'priority-badge';
          priorityBadge.style.fontSize = '12px';
          priorityBadge.style.padding = '3px 8px';
          priorityBadge.style.borderRadius = '3px';
          priorityBadge.style.marginLeft = '10px';
          
          switch(task.priority) {
            case 'important':
              priorityBadge.textContent = 'Önemli';
              priorityBadge.style.backgroundColor = '#FF9800';
              priorityBadge.style.color = 'white';
              break;
            case 'urgent':
              priorityBadge.textContent = 'Acil';
              priorityBadge.style.backgroundColor = '#F44336';
              priorityBadge.style.color = 'white';
              break;
            default:
              priorityBadge.textContent = 'Normal';
              priorityBadge.style.backgroundColor = '#4CAF50';
              priorityBadge.style.color = 'white';
          }
          
          taskText.appendChild(priorityBadge);
        }
        
        // Görev detayları
        const taskDetails = document.createElement('div');
        taskDetails.className = 'task-details';
        taskDetails.style.fontSize = '13px';
        taskDetails.style.color = '#666';
        
        // Atayan kişi
        if (task.assignedBy) {
          const assignedBy = document.createElement('span');
          assignedBy.className = 'assigned-by';
          assignedBy.innerHTML = `<i class="fas fa-user-shield"></i> Atayan: ${task.assignedBy}`;
          assignedBy.style.marginRight = '15px';
          taskDetails.appendChild(assignedBy);
        }
        
        // Oluşturulma tarihi
        const createdAt = document.createElement('span');
        createdAt.className = 'created-at';
        createdAt.innerHTML = `<i class="fas fa-calendar-plus"></i> Oluşturulma: ${formatDate(task.createdAt)}`;
        createdAt.style.marginRight = '15px';
        taskDetails.appendChild(createdAt);
        
        // Tamamlanma tarihi (eğer tamamlanmışsa)
        if (isCompleted && task.completedAt) {
          const completedAt = document.createElement('span');
          completedAt.className = 'completed-at';
          completedAt.innerHTML = `<i class="fas fa-check-circle"></i> Tamamlanma: ${formatDate(task.completedAt)}`;
          taskDetails.appendChild(completedAt);
        }
        
        // Görev içeriğini oluştur
        taskContent.appendChild(taskText);
        taskContent.appendChild(taskDetails);
        
        // Durum göstergesi
        const statusIndicator = document.createElement('div');
        statusIndicator.className = 'status-indicator';
        statusIndicator.style.padding = '5px 10px';
        statusIndicator.style.borderRadius = '15px';
        statusIndicator.style.fontSize = '12px';
        statusIndicator.style.fontWeight = 'bold';
        
        if (isCompleted) {
          statusIndicator.textContent = 'Tamamlandı';
          statusIndicator.style.backgroundColor = '#4CAF50';
          statusIndicator.style.color = 'white';
        } else {
          statusIndicator.textContent = 'Bekliyor';
          statusIndicator.style.backgroundColor = '#FF9800';
          statusIndicator.style.color = 'white';
        }
        
        // Görev öğesini oluştur
        taskItem.appendChild(taskContent);
        taskItem.appendChild(statusIndicator);
        
        return taskItem;
      }
      
      // Tarih formatı fonksiyonu
      function formatDate(dateString) {
        const date = new Date(dateString);
        const day = date.getDate().toString().padStart(2, '0');
        const month = (date.getMonth() + 1).toString().padStart(2, '0');
        const year = date.getFullYear();
        const hours = date.getHours().toString().padStart(2, '0');
        const minutes = date.getMinutes().toString().padStart(2, '0');
        
        return `${day}.${month}.${year} ${hours}:${minutes}`;
      }
    });
  </script>
</body>
</html>